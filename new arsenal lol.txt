--[[
    PandazWare: Arsenal "Rage Edition" (Rebuilt)
    - Source: OffenseWare / Binxix / Custom Rage Logic
    - UI: PandazWare Library
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // 1. LIBRARY INIT //
local LibraryURL = "https://raw.githubusercontent.com/PandazWare/PandazWare/refs/heads/main/PandazWare%20libary"
local success, PandazWare = pcall(function() return loadstring(game:HttpGet(LibraryURL))() end)

if not success or not PandazWare then 
    warn("Library Failed to Load! Check Link.")
    return 
end

-- // 2. CONFIGURATION //
getgenv().Config = {
    Combat = {
        Aimbot = false,
        FOV = 120,
        Smoothing = 0.5,
        WallCheck = true,
        TargetPart = "Head",
        AutoShoot = false
    },
    Rage = {
        KillAll = false,      -- Custom Feature
        KillDelay = 0.2,      -- Zeit zwischen Kills (in Sekunden)
        TeleportDist = 4,     -- Studs hinter dem Gegner
        Fly = false,
        FlySpeed = 60
    },
    Visuals = {
        ESP = false,
        Boxes = true,
        Tracers = false,
        Skeletons = true,
        Name = false,
        Health = false,
        Chams = false
    },
    Gun = {
        InfAmmo = false,
        RapidFire = false,
        NoRecoil = false
    }
}

-- // 3. UTILITIES //
local function IsEnemy(plr)
    if not plr or not plr.Team then return true end
    return plr.Team ~= LocalPlayer.Team
end

local function IsVisible(targetPart)
    if not Config.Combat.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = targetPart.Position - origin
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    params.IgnoreWater = true
    local result = Workspace:Raycast(origin, direction, params)
    return not result or result.Instance:IsDescendantOf(targetPart.Parent)
end
--[[
    PandazWare: Arsenal "Rage Edition"
    PART 2: Rage Logic, Movement & Weapon Mods
]]

-- // CUSTOM RAGE LOGIC: KILL ALL //
task.spawn(function()
    while true do
        if Config.Rage.KillAll then
            pcall(function()
                for _, enemy in pairs(Players:GetPlayers()) do
                    if not Config.Rage.KillAll then break end -- Not-Aus
                    
                    if enemy ~= LocalPlayer and IsEnemy(enemy) and enemy.Character then
                        local eRoot = enemy.Character:FindFirstChild("HumanoidRootPart")
                        local eHead = enemy.Character:FindFirstChild("Head")
                        local eHum = enemy.Character:FindFirstChild("Humanoid")
                        local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        
                        if eRoot and eHead and eHum and eHum.Health > 0 and myRoot then
                            -- 1. TP hinter Gegner (Safe Spot)
                            local behindCFrame = eRoot.CFrame * CFrame.new(0, 0, Config.Rage.TeleportDist)
                            myRoot.CFrame = behindCFrame
                            
                            -- 2. Hard Lock Aim (Sofort auf Kopf)
                            Camera.CFrame = CFrame.new(Camera.CFrame.Position, eHead.Position)
                            
                            -- 3. Auto Shoot (Simuliert Klick)
                            VirtualUser:CaptureController()
                            VirtualUser:Button1Down(Vector2.new(0,0), Camera.CFrame)
                            task.wait(0.05)
                            VirtualUser:Button1Up(Vector2.new(0,0), Camera.CFrame)
                            
                            -- 4. Wartezeit (Verhindert Crash/Kick)
                            task.wait(Config.Rage.KillDelay)
                        end
                    end
                end
            end)
        else
            task.wait(0.5) -- Idle wait wenn aus
        end
        task.wait() -- Kurzer Loop Wait
    end
end)

-- // OFFENSEWARE FLY SYSTEM //
local fbv, fbg
local function ToggleFly(s)
    if s then
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
        local hrp = LocalPlayer.Character.HumanoidRootPart
        fbv = Instance.new("BodyVelocity", hrp); fbv.MaxForce = Vector3.new(1e5,1e5,1e5)
        fbg = Instance.new("BodyGyro", hrp); fbg.MaxTorque = Vector3.new(1e5,1e5,1e5)
        LocalPlayer.Character.Humanoid.PlatformStand = true
    else
        if fbv then fbv:Destroy() end; if fbg then fbg:Destroy() end
        if LocalPlayer.Character then LocalPlayer.Character.Humanoid.PlatformStand = false end
    end
end

RunService.Heartbeat:Connect(function()
    if Config.Rage.Fly and fbv then
        local cam = workspace.CurrentCamera
        local mv = LocalPlayer.Character.Humanoid.MoveDirection
        local fd = (cam.CFrame.LookVector * mv.Z * -1) + (cam.CFrame.RightVector * mv.X)
        fbv.Velocity = mv.Magnitude == 0 and Vector3.zero or fd * Config.Rage.FlySpeed
        fbg.CFrame = cam.CFrame
    end
end)

-- // OFFENSEWARE GUN MODS //
task.spawn(function()
    local wkspc = ReplicatedStorage:WaitForChild("wkspc", 5)
    local Weapons = ReplicatedStorage:WaitForChild("Weapons", 5)
    while task.wait(1) do
        if Config.Gun.InfAmmo and wkspc and wkspc:FindFirstChild("CurrentCurse") then
            -- Setzt "Infinite Ammo" Value in ReplicatedStorage
            if wkspc.CurrentCurse.Value ~= "Infinite Ammo" then wkspc.CurrentCurse.Value = "Infinite Ammo" end
        end
        
        if Weapons and (Config.Gun.RapidFire or Config.Gun.NoRecoil) then
            for _, v in ipairs(Weapons:GetChildren()) do
                if Config.Gun.RapidFire then
                    local fr = v:FindFirstChild("FireRate"); if fr and fr.Value > 0.04 then fr.Value = 0.04 end
                    local auto = v:FindFirstChild("Auto"); if auto then auto.Value = true end
                end
                if Config.Gun.NoRecoil then
                    local rc = v:FindFirstChild("RecoilControl"); if rc then rc.Value = 0 end
                    local sp = v:FindFirstChild("Spread"); if sp then sp.Value = 0 end
                end
            end
        end
    end
end)
--[[
    PandazWare: Arsenal "Rage Edition"
    PART 3: Aimbot, Visuals & UI
]]

-- // AIMBOT LOGIC //
local function GetClosestTarget()
    local closest, shortest = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and IsEnemy(v) and v.Character then
            local part = v.Character:FindFirstChild(Config.Combat.TargetPart)
            local hum = v.Character:FindFirstChild("Humanoid")
            
            if part and hum and hum.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                    if dist < shortest and dist <= Config.Combat.FOV then
                        if IsVisible(part) then
                            closest = part
                            shortest = dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if Config.Combat.Aimbot then
        local target = GetClosestTarget()
        if target then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, target.Position), Config.Combat.Smoothing)
        end
    end
end)

-- // ESP SYSTEM (OffenseWare Billboard Style) //
local ESP_Storage = {}
local function CreateESP(plr)
    if ESP_Storage[plr] then return end
    local BGui = Instance.new("BillboardGui")
    BGui.Name = "ESP"; BGui.AlwaysOnTop = true; BGui.Size = UDim2.new(4,0,5.5,0)
    local Frame = Instance.new("Frame", BGui); Frame.Size = UDim2.new(1,0,1,0); Frame.BackgroundTransparency = 1
    local Stroke = Instance.new("UIStroke", Frame); Stroke.Color = Color3.fromRGB(255,0,0); Stroke.Thickness = 1.5
    ESP_Storage[plr] = {Gui = BGui, Stroke = Stroke}
end

local function UpdateESP()
    for plr, obj in pairs(ESP_Storage) do
        if not plr.Parent or not plr.Character or not Config.Visuals.ESP or not IsEnemy(plr) then
            obj.Gui.Parent = nil
        else
            local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                obj.Gui.Parent = game.CoreGui
                obj.Gui.Adornee = hrp
                obj.Stroke.Enabled = Config.Visuals.Boxes
                obj.Stroke.Color = Color3.fromRGB(255,0,0) -- Standard Red for Enemies
            end
        end
    end
end
RunService.RenderStepped:Connect(UpdateESP)
Players.PlayerAdded:Connect(CreateESP)
for _, p in pairs(Players:GetPlayers()) do if p ~= LocalPlayer then CreateESP(p) end end

-- // PANDAZWARE UI SETUP //
local Window = PandazWare:CreateWindow({Title = "PandazWare | Arsenal Rage"})

-- TAB: RAGE (Dein neuer Tab)
local Rage = Window:CreateTab("Rage")
Rage:Toggle("Kill All (Loop)", false, function(v) 
    Config.Rage.KillAll = v 
    if v then PandazWare:Notify("Warning", "Kill All active! Watch out for bans.", 3) end
end)
Rage:Slider("Kill Delay", 0, 20, 2, function(v) Config.Rage.KillDelay = v/10 end)
Rage:Button("--- Movement ---", function() end)
Rage:Toggle("Fly", false, function(v) 
    Config.Rage.Fly = v
    ToggleFly(v)
end)
Rage:Slider("Fly Speed", 10, 200, 60, function(v) Config.Rage.FlySpeed = v end)

-- TAB: COMBAT
local Combat = Window:CreateTab("Combat")
Combat:Toggle("Legit Aimbot", false, function(v) Config.Combat.Aimbot = v end)
Combat:Slider("FOV Radius", 10, 500, 120, function(v) Config.Combat.FOV = v end)
Combat:Slider("Smoothing", 0, 100, 50, function(v) Config.Combat.Smoothing = v/100 end)
Combat:Toggle("Wall Check", true, function(v) Config.Combat.WallCheck = v end)

-- TAB: VISUALS
local Vis = Window:CreateTab("Visuals")
Vis:Toggle("ESP Active", false, function(v) Config.Visuals.ESP = v end)
Vis:Toggle("Boxes", true, function(v) Config.Visuals.Boxes = v end)

-- TAB: GUN MODS
local Guns = Window:CreateTab("Gun Mods")
Guns:Toggle("Infinite Ammo", false, function(v) Config.Gun.InfAmmo = v end)
Guns:Toggle("Rapid Fire", false, function(v) Config.Gun.RapidFire = v end)
Guns:Toggle("No Recoil", false, function(v) Config.Gun.NoRecoil = v end)

PandazWare:Notify("Loaded", "Rage Script Ready.", 3)
