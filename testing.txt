-- // PANDAZWARE FINAL: PART 1 // --
-- Library: Loaded via URL (Updated Version with Sliders)
-- Features: Old Gun Mods + Spinbot + Wallbang + Skin Changer

getgenv().SecureMode = true

-- [ SERVICES ]
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- [ SETTINGS (FLAGS) ]
local Flags = {
    -- Legit
    Aimbot = false, FOV = 100, Smooth = 0.5, WallCheck = true, HitChance = 100, ShowFOV = false,
    -- Rage
    SilentAim = false, Hitbox = false, HitboxSize = 4, Spinbot = false, SpinSpeed = 50,
    Wallbang = false, -- NEU
    -- Visuals
    ESP_Chams = false, ESP_Box = false, ESP_Skel = false, ESP_Trace = false, 
    Fullbright = false, ClearMap = false, SkinChanger = false, -- NEU
    -- Gun Mods
    NoRecoil = false, NoSpread = false, RapidFire = false, InfAmmo = false, InstaReload = false,
    -- Misc
    TP = false, TPDist = 12, Speed = false, SpeedVal = 16, Bhop = false
}

-- [ LOAD LIBRARY ]
-- Lädt deine geupdatete Library (mit Slidern)
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/PandazWare/PandazWare/refs/heads/main/PandazWare%20libary"))()

-- [ CREATE WINDOW ]
local Window = Library:CreateWindow({Title = "PandazWare"})
Library:Notify("PandazWare", "Library Updated & Loaded!", 3)
-- // PANDAZWARE FINAL: PART 2 // --
-- Functions & Logic

local DrawCache = {Skeleton={}, Chams={}, Tracers={}}
local FOVCircle = Drawing.new("Circle"); FOVCircle.Thickness = 1.5; FOVCircle.NumSides = 60; FOVCircle.Filled = false; FOVCircle.Color = Color3.fromRGB(0, 255, 170)
local SkeletonConnections = {{"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"Head", "Torso"}, {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"}, {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"}, {"Torso", "Left Leg"}, {"Torso", "Right Leg"}}

local function GetTarget()
    local target, dist = nil, Flags.FOV
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild("Head") and p.Character.Humanoid.Health > 0 then
            local pos, vis = Camera:WorldToViewportPoint(p.Character.Head.Position)
            if vis and (Vector2.new(pos.X, pos.Y) - center).Magnitude < dist then
                target = p.Character.Head; dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
            end
        end
    end
    return target
end

-- [ OLD GUN MODS (Unverändert) ]
local function ApplyGunMods()
    local W = ReplicatedStorage:WaitForChild("Weapons")
    for _, w in ipairs(W:GetChildren()) do
        if Flags.RapidFire and w:FindFirstChild("FireRate") then w.FireRate.Value = 0 end
        if Flags.NoSpread then
             local s = w:FindFirstChild("Spread")
             if s then
                if s:IsA("ValueBase") then s.Value = 0 end
                for _, c in ipairs(s:GetChildren()) do if c:IsA("NumberValue") then c.Value = 0 end end
             end
        end
        if Flags.NoRecoil then
             local r = w:FindFirstChild("Recoil")
             if r then for _, c in ipairs(r:GetChildren()) do if c:IsA("NumberValue") then c.Value = 0 end end end
        end
        if Flags.InfAmmo and w:FindFirstChild("Ammo") then w.Ammo.Value = 999 end
        if Flags.InfAmmo and w:FindFirstChild("StoredAmmo") then w.StoredAmmo.Value = 9999 end
        if Flags.InstaReload and w:FindFirstChild("ReloadTime") then w.ReloadTime.Value = 0.05 end
    end
end

-- [ NEW: SKIN CHANGER ]
local function ApplySkins()
    if not Flags.SkinChanger then return end
    local SkinsFolder = ReplicatedStorage:FindFirstChild("Skins")
    if not SkinsFolder then return end
    
    local Character = LocalPlayer.Character
    if not Character then return end
    
    for _, Tool in pairs(Character:GetChildren()) do
        if Tool:IsA("Tool") then
            -- Einfacher Neon Skin Apply (Pandaz Style)
            for _, Part in pairs(Tool:GetDescendants()) do
                if Part:IsA("MeshPart") or Part:IsA("UnionOperation") then
                    if Part.Material ~= Enum.Material.Neon then
                        Part.Material = Enum.Material.Neon
                        Part.Color = Color3.fromRGB(0, 255, 170)
                    end
                end
            end
        end
    end
end

-- [ VISUALS HELPER ]
local function UpdateESP(p)
    if not DrawCache.Skeleton[p] then DrawCache.Skeleton[p] = {} end
    if Flags.ESP_Skel and p.Team ~= LocalPlayer.Team and p.Character then
        for i, link in pairs(SkeletonConnections) do
            local p1, p2 = p.Character:FindFirstChild(link[1]), p.Character:FindFirstChild(link[2])
            if p1 and p2 then
                local l = DrawCache.Skeleton[p][i] or Drawing.new("Line"); l.Thickness = 1.5; l.Color = Color3.new(1,1,1); l.Transparency = 1; DrawCache.Skeleton[p][i] = l
                local v1, on1 = Camera:WorldToViewportPoint(p1.Position); local v2, on2 = Camera:WorldToViewportPoint(p2.Position)
                if on1 and on2 then l.Visible = true; l.From = Vector2.new(v1.X, v1.Y); l.To = Vector2.new(v2.X, v2.Y) else l.Visible = false end
            end
        end
    else for _, v in pairs(DrawCache.Skeleton[p]) do v.Visible = false end end

    if Flags.ESP_Chams and p.Team ~= LocalPlayer.Team and p.Character then
        if not p.Character:FindFirstChild("PZCham") then
            local h = Instance.new("Highlight", p.Character); h.Name = "PZCham"; h.FillColor = Color3.fromRGB(0,255,170); h.OutlineTransparency = 1; h.FillTransparency = 0.5
        end
    elseif p.Character and p.Character:FindFirstChild("PZCham") then p.Character.PZCham:Destroy() end
end
-- // PANDAZWARE FINAL: PART 3 // --
-- UI, Hooks & Execution

-- [ TABS & UI ]
local Legit = Window:CreateTab("Legit")
Legit:Toggle("Aimbot", false, function(v) Flags.Aimbot = v end)
Legit:Slider("FOV", 10, 400, 100, function(v) Flags.FOV = v end)
Legit:Slider("Smooth", 1, 10, 5, function(v) Flags.Smooth = v/10 end)
Legit:Toggle("Show FOV", false, function(v) Flags.ShowFOV = v end)

local Rage = Window:CreateTab("Rage")
Rage:Toggle("Silent Aim", false, function(v) Flags.SilentAim = v end)
Rage:Toggle("Wallbang", false, function(v) Flags.Wallbang = v end) -- NEU
Rage:Toggle("Spinbot", false, function(v) Flags.Spinbot = v end)
Rage:Slider("Spin Speed", 10, 100, 50, function(v) Flags.SpinSpeed = v end)
Rage:Toggle("Hitbox Extender", false, function(v) Flags.Hitbox = v end)
Rage:Slider("Hitbox Size", 2, 10, 4, function(v) Flags.HitboxSize = v end)

local Visuals = Window:CreateTab("Visuals")
Visuals:Toggle("Chams", false, function(v) Flags.ESP_Chams = v end)
Visuals:Toggle("Skeleton ESP", false, function(v) Flags.ESP_Skel = v end)
Visuals:Toggle("Fullbright", false, function(v) Flags.Fullbright = v end)
Visuals:Toggle("Skin Changer", false, function(v) Flags.SkinChanger = v end) -- NEU

local Gun = Window:CreateTab("Gun Mods")
Gun:Toggle("No Recoil", false, function(v) Flags.NoRecoil = v end)
Gun:Toggle("No Spread", false, function(v) Flags.NoSpread = v end)
Gun:Toggle("Rapid Fire", false, function(v) Flags.RapidFire = v end)
Gun:Toggle("Infinite Ammo", false, function(v) Flags.InfAmmo = v end)

local Misc = Window:CreateTab("Misc")
Misc:Toggle("Speed Hack", false, function(v) Flags.Speed = v end)
Misc:Slider("Speed Val", 16, 100, 25, function(v) Flags.SpeedVal = v end)
Misc:Toggle("Bhop", false, function(v) Flags.Bhop = v end)
Misc:Toggle("3rd Person", false, function(v) Flags.TP = v end)

-- [ HOOKS ]
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local args = {...}
    local method = getnamecallmethod()
    
    -- 1. Silent Aim (Override Target)
    if Flags.SilentAim and method == "FireServer" and (self.Name == "Fire" or self.Name == "Shoot") then
        local t = GetTarget()
        if t then
            for i, v in pairs(args) do
                if typeof(v) == "Vector3" then args[i] = t.Position end
            end
            return oldNamecall(self, unpack(args))
        end
    end

    -- 2. Wallbang Hook (aus Logs)
    if Flags.Wallbang and (method == "FindPartOnRayWithIgnoreList" or method == "Raycast") then
        if method == "FindPartOnRayWithIgnoreList" then
            local ignoreList = args[2] or {}
            table.insert(ignoreList, Workspace.Map) -- Map ignorieren für Wallbang
            args[2] = ignoreList
            return oldNamecall(self, unpack(args))
        end
    end
    
    return oldNamecall(self, ...)
end)
setreadonly(mt, true)

-- [ LOOPS ]
RunService.RenderStepped:Connect(function()
    FOVCircle.Visible = Flags.ShowFOV; FOVCircle.Radius = Flags.FOV
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    -- Aimbot
    if Flags.Aimbot and not Flags.SilentAim then
        local t = GetTarget()
        if t then Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, t.Position), 1 - Flags.Smooth) end
    end
    
    -- Spinbot
    if Flags.Spinbot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(Flags.SpinSpeed), 0)
    end
    
    -- Visuals
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then UpdateESP(p) end
    end
end)

-- Slow Loop (Mods)
task.spawn(function()
    while true do
        task.wait(0.5)
        if Flags.NoRecoil or Flags.NoSpread or Flags.RapidFire or Flags.InfAmmo or Flags.InstaReload then ApplyGunMods() end
        if Flags.SkinChanger then ApplySkins() end
        if Flags.Speed and LocalPlayer.Character then LocalPlayer.Character.Humanoid.WalkSpeed = Flags.SpeedVal end
        if Flags.Bhop and LocalPlayer.Character and LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 and LocalPlayer.Character.Humanoid.FloorMaterial ~= Enum.Material.Air then LocalPlayer.Character.Humanoid.Jump = true end
        if Flags.Hitbox then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") then
                    p.Character.Head.Size = Vector3.new(Flags.HitboxSize, Flags.HitboxSize, Flags.HitboxSize)
                    p.Character.Head.Transparency = 0.7; p.Character.Head.CanCollide = false
                end
            end
        end
        if Flags.Fullbright then Lighting.Brightness = 2; Lighting.ClockTime = 14 else Lighting.Brightness = 1 end
        if Flags.TP then LocalPlayer.CameraMode = Enum.CameraMode.Classic; LocalPlayer.CameraMaxZoomDistance = Flags.TPDist; LocalPlayer.CameraMinZoomDistance = Flags.TPDist else LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson; LocalPlayer.CameraMaxZoomDistance = 0.5 end
    end
end)

